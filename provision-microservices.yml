parameters:
  - name: serviceName
    type: string
    displayName: Service Name
    
  - name: planType
    type: string
    values:
      - AppServicePlan
      - Consumption
    displayName: App Service Plan

pool:
  vmImage: windows-latest

trigger: none

pr: none

name: $(Year:yyyy).$(Month).$(DayOfMonth)$(Rev:.r)

stages: 
  - stage: Build
    jobs:       
    - template: 'jobs/build-job.yml'

  - stage: Development_AU
    dependsOn: Build
    condition: succeeded('Build')  
    displayName: 'Staging AU'
    variables:
    - template: 'variables/pipeline-variables.DEV.yml'
      parameters:
        serviceName: ${{ parameters.serviceName }}
    jobs:  
    - template: 'jobs/function/function-deploy-job.yml'
      parameters:
        environmentName: DEV
        siteName: ${{ variables.AUFunctionName  }}
        planType: ${{ parameters.planType }}
        regionName: AU

  - stage: Development_US
    dependsOn: Build
    condition: succeeded('Build')  
    displayName: 'Staging US'
    variables:
    - template: 'variables/pipeline-variables.DEV.yml'
      parameters:
        serviceName: ${{ parameters.serviceName }}
    jobs:  
    - template: 'jobs/function/function-deploy-job.yml'
      parameters:
        environmentName: DEV
        siteName: ${{ variables.USFunctionName  }}
        planType: ${{ parameters.planType }}
        regionName: US       